// å¼ºåˆ¶ä¿®å¤å¯¼èˆªæ ä¸­æ–‡æ˜¾ç¤º
document.addEventListener('DOMContentLoaded', function() {
    // ä¿®å¤å¯¼èˆªæ èœå•æ–‡å­—
    const menuItems = {
        '/': 'ğŸ  é¦–é¡µ',
        '/archives/': 'ğŸ“ å½’æ¡£', 
        '/categories.html': 'ğŸ“‚ åˆ†ç±»',
        '/about/': 'â¤ï¸ å…³äº'
    };
    
    // åˆ é™¤Tagsèœå•é¡¹
    const tagsMenu = document.querySelector('#nav .site-nav a[href*="tags"]');
    if (tagsMenu) {
        tagsMenu.parentElement.remove();
    }
    
    // ç¡®ä¿å¯¼èˆªæ æ˜¾ç¤º
    const nav = document.querySelector('#nav');
    if (nav) {
        nav.style.display = 'block';
        nav.style.visibility = 'visible';
    }
    
    // ç¡®ä¿æ–‡ç« é¡µé¢æ˜¾ç¤ºæ ‡é¢˜
    const postTitle = document.querySelector('#post-info h1.post-title');
    const postInfo = document.querySelector('#post-info');
    
    if (postInfo && !postTitle) {
        // ä»é¡µé¢æ ‡é¢˜æˆ–å…¶ä»–åœ°æ–¹è·å–æ ‡é¢˜
        const pageTitle = document.title.split(' | ')[0];
        if (pageTitle && pageTitle !== 'æˆ‘çš„æŠ€æœ¯åšå®¢') {
            const titleElement = document.createElement('h1');
            titleElement.className = 'post-title';
            titleElement.textContent = pageTitle;
            postInfo.insertBefore(titleElement, postInfo.firstChild);
        }
    }
    
    // ä¿®å¤å³ä¾§è¾¹æ æ˜¾ç¤º
    const asideContent = document.querySelector('#aside-content');
    if (asideContent) {
        asideContent.style.display = 'block';
        asideContent.style.visibility = 'visible';
    }
    
    // ç­‰å¾…å¯¼èˆªæ åŠ è½½å®Œæˆåå†ä¿®æ”¹
    setTimeout(() => {
        Object.keys(menuItems).forEach(href => {
            const menuLink = document.querySelector(`#nav .menus_items .menus_item a[href="${href}"]`);
            if (menuLink) {
                // æ¸…é™¤åŸæ–‡å­—ï¼Œåªä¿ç•™å›¾æ ‡å’Œä¸­æ–‡
                const icon = menuLink.querySelector('i');
                menuLink.innerHTML = '';
                if (icon) {
                    menuLink.appendChild(icon);
                    menuLink.innerHTML += ' ' + menuItems[href].split(' ')[1];
                } else {
                    menuLink.textContent = menuItems[href];
                }
            }
        });
    }, 100);
    
    // ä¿®å¤æ–‡ç« é¡µé¢æ ‡é¢˜æ˜¾ç¤º
    if (document.body.classList.contains('post')) {
        // ç¡®ä¿å¯¼èˆªæ åœ¨æ–‡ç« é¡µé¢ä¹Ÿæ˜¾ç¤º
        const pageHeader = document.querySelector('#page-header');
        if (pageHeader) {
            pageHeader.style.display = 'block';
            pageHeader.style.position = 'fixed';
            pageHeader.style.top = '0';
            pageHeader.style.zIndex = '9999';
        }
        
        // è·å–æ–‡ç« æ ‡é¢˜
        setTimeout(() => {
            const articleContainer = document.querySelector('#article-container');
            if (articleContainer) {
                // æŸ¥æ‰¾æ–‡ç« æ ‡é¢˜ï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½
                const postTitle = document.querySelector('#post-info h1.post-title') || 
                                document.querySelector('h1.post-title') || 
                                document.querySelector('.post-title h1') || 
                                document.querySelector('#post-info h1') ||
                                document.querySelector('#article-container h1') ||
                                document.title.split(' - ')[0]; // æœ€åä½¿ç”¨é¡µé¢æ ‡é¢˜
                
                const titleText = typeof postTitle === 'string' ? postTitle : (postTitle ? postTitle.textContent : 'æ–‡ç« æ ‡é¢˜');
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨è‡ªå®šä¹‰æ ‡é¢˜å®¹å™¨
                if (!document.querySelector('.custom-post-header')) {
                    // åˆ›å»ºæ–°çš„æ ‡é¢˜å®¹å™¨
                    const titleContainer = document.createElement('div');
                    titleContainer.className = 'custom-post-header';
                    titleContainer.innerHTML = `
                        <div class="custom-post-title-bg">
                            <h1 class="custom-post-title">${titleText}</h1>
                            <div class="custom-post-meta">
                                <span class="custom-wordcount">ğŸ“ æ­£åœ¨è®¡ç®—å­—æ•°...</span>
                                <span class="custom-reading-time">â±ï¸ æ­£åœ¨è®¡ç®—é˜…è¯»æ—¶é—´...</span>
                            </div>
                        </div>
                    `;
                    
                    // æ’å…¥åˆ°æ–‡ç« å®¹å™¨å‰
                    articleContainer.parentNode.insertBefore(titleContainer, articleContainer);
                    
                    // è®¡ç®—å­—æ•°å’Œé˜…è¯»æ—¶é—´
                    const articleContent = articleContainer.textContent || '';
                    const wordCount = articleContent.length;
                    const readingTime = Math.ceil(wordCount / 300); // å‡è®¾æ¯åˆ†é’Ÿ300å­—
                    
                    setTimeout(() => {
                        const wordcountSpan = document.querySelector('.custom-wordcount');
                        const readingTimeSpan = document.querySelector('.custom-reading-time');
                        
                        if (wordcountSpan) wordcountSpan.textContent = `ğŸ“ ${wordCount} å­—`;
                        if (readingTimeSpan) readingTimeSpan.textContent = `â±ï¸ çº¦ ${readingTime} åˆ†é’Ÿ`;
                    }, 500);
                }
                
                // éšè—åŸå§‹çš„æ–‡ç« æ ‡é¢˜
                const originalTitles = document.querySelectorAll('#post-info, .post-title, #page-header.post-bg');
                originalTitles.forEach(el => {
                    if (el && el.id === 'post-info') {
                        el.style.display = 'none';
                    }
                });
            }
        }, 200);
    }
    
    // å¼ºåˆ¶æ˜¾ç¤ºæ‰€æœ‰å›¾ç‰‡
    const images = document.querySelectorAll('img');
    images.forEach(img => {
        if (img.hasAttribute('data-src')) {
            img.src = img.getAttribute('data-src');
            img.removeAttribute('data-src');
        }
        img.style.opacity = '1';
        img.style.visibility = 'visible';
        img.style.display = 'block';
    });
    
    // ä¿®å¤PlantUMLä»£ç å—è¯†åˆ«
    const codeBlocks = document.querySelectorAll('figure.highlight');
    codeBlocks.forEach(block => {
        const code = block.querySelector('code');
        if (code && code.textContent.includes('@startuml')) {
            block.classList.add('plantuml');
            const caption = block.querySelector('figcaption');
            if (caption) {
                caption.innerHTML = 'ğŸŒ± PlantUML';
            }
        }
    });
});

// æ·»åŠ è‡ªå®šä¹‰æ ·å¼
const customStyles = `
    .custom-post-header {
        margin: 2rem auto;
        max-width: 900px;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .custom-post-title-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 3rem 2rem 2rem 2rem;
        text-align: center;
    }
    
    .custom-post-title {
        font-size: 2.5rem;
        font-weight: 800;
        margin: 0 0 1.5rem 0;
        line-height: 1.3;
    }
    
    .custom-post-meta {
        display: flex;
        justify-content: center;
        gap: 2rem;
        flex-wrap: wrap;
    }
    
    .custom-wordcount,
    .custom-reading-time {
        background: rgba(255, 255, 255, 0.2);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.95rem;
        font-weight: 600;
        backdrop-filter: blur(10px);
    }
    
    @media (max-width: 768px) {
        .custom-post-title {
            font-size: 2rem;
        }
        
        .custom-post-meta {
            gap: 1rem;
        }
        
        .custom-post-title-bg {
            padding: 2rem 1rem 1.5rem 1rem;
        }
    }
`;

// æ³¨å…¥æ ·å¼
const styleSheet = document.createElement('style');
styleSheet.textContent = customStyles;
document.head.appendChild(styleSheet); 