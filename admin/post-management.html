<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文章管理 - 博客管理系统</title>
  <link rel="stylesheet" href="/admin/css/modern-layout.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">
  <link rel="stylesheet" href="/admin/css/global-header.css">
  <link rel="stylesheet" href="/admin/css/admin-menu.css">
  <link rel="stylesheet" href="/admin/css/fix-background.css">
  <link rel="stylesheet" href="/admin/css/unified-layout.css">
  
  <script src="/admin/js/api-interceptor.js"></script>
  <script src="/admin/js/common-menu.js"></script>
</head>
<body>
  <div class="admin-container">
    <!-- 顶部导航栏 -->
    <header class="admin-header">
      <div class="admin-logo">博客管理系统</div>
      <div class="admin-header-actions">
        <a href="/" target="_blank" class="dashboard-button">
          <i class="fas fa-external-link-alt"></i> 查看网站
        </a>
        <a href="javascript:void(0);" onclick="logout()" class="logout-button">
          <i class="fas fa-sign-out-alt"></i> 注销
        </a>
      </div>
    </header>
    
    <!-- 侧边导航栏 - 由common-menu.js动态生成 -->
    <aside class="admin-sidebar"></aside>
    
    <!-- 移动端菜单按钮 -->
    <button class="menu-toggle" id="menuToggle">
      <i class="fas fa-bars"></i>
    </button>
    
    <!-- 主内容区域 -->
    <main class="admin-main">
      <div class="page-container">
        <div class="page-header">
          <div class="page-title">文章列表</div>
        </div>
        
        <div class="page-content">
          <!-- 搜索和筛选区域 -->
          <div class="search-filter-area">
            <div class="search-box">
              <input type="text" id="searchInput" placeholder="搜索文章标题..." class="admin-form-input">
              <select id="categoryFilter" class="admin-form-input">
                <option value="">所有分类</option>
              </select>
              <select id="statusFilter" class="admin-form-input">
                <option value="">所有状态</option>
                <option value="published">已发布</option>
                <option value="draft">草稿</option>
              </select>
              <button class="admin-btn admin-btn-primary" onclick="searchPosts()">
                <i class="fas fa-search"></i> 搜索
              </button>
              <button class="admin-btn admin-btn-text" onclick="clearSearch()">
                <i class="fas fa-redo"></i> 重置
              </button>
            </div>
            
            <!-- 操作按钮组 -->
            <div class="action-buttons">
              <button class="admin-btn admin-btn-primary" onclick="createNewPost()">
                <i class="fas fa-plus"></i> 新建文章
              </button>
              <button class="admin-btn admin-btn-success" onclick="importFromYuque()">
                <i class="fas fa-download"></i> 语雀导入
              </button>
            </div>
          </div>

          <!-- 统计信息 -->
          <div class="posts-stats">
            共 <span id="totalPosts">0</span> 篇文章，当前第 <span id="currentPage">1</span>/<span id="totalPages">1</span> 页
          </div>

          <!-- 文章列表 -->
          <div class="posts-table-container">
            <table class="posts-table">
              <thead>
                <tr>
                  <th width="40%">文章标题</th>
                  <th width="15%" class="sortable" onclick="sortPosts('date')">
                    发布日期 <i class="fas fa-sort" id="date-sort-icon"></i>
                  </th>
                  <th width="15%">分类</th>
                  <th width="10%">标签</th>
                  <th width="10%">状态</th>
                  <th width="10%">操作</th>
                </tr>
              </thead>
              <tbody id="postsTableBody">
                <tr>
                  <td colspan="6" class="loading-row">
                    <div class="loading-spinner"></div>
                    正在加载文章列表...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- 分页控件 -->
          <div class="pagination-container" id="paginationContainer">
            <button class="pagination-btn" onclick="goToPage(1)">首页</button>
            <button class="pagination-btn" onclick="goToPage(currentPage - 1)">上一页</button>
            <span class="pagination-info">第 <span id="currentPageNum">1</span> 页</span>
            <button class="pagination-btn" onclick="goToPage(currentPage + 1)">下一页</button>
            <button class="pagination-btn" onclick="goToPage(totalPages)">末页</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <style>
    /* 页面特定样式 */
    .page-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .search-filter-area {
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
    }

    .search-box {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr auto auto;
      gap: 15px;
      align-items: center;
      flex: 1;
      max-width: 700px;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .posts-stats {
      margin-bottom: 15px;
      color: #606266;
      font-size: 14px;
    }

    .posts-table-container {
      background: white;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .posts-table {
      width: 100%;
      border-collapse: collapse;
    }

    .posts-table th {
      background: #f5f7fa;
      padding: 12px 15px;
      text-align: left;
      font-weight: 600;
      color: #303133;
      border-bottom: 1px solid #ebeef5;
    }

    .posts-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #ebeef5;
      vertical-align: middle;
    }

    .posts-table tr:hover {
      background: #f5f7fa;
    }

    .post-title {
      font-weight: 500;
      color: #303133;
      cursor: pointer;
    }

    .post-title:hover {
      color: #409EFF;
    }

    .post-status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .post-status.published {
      background: #f0f9ff;
      color: #67c23a;
    }

    .post-status.draft {
      background: #fef3e2;
    }

    /* 分页样式优化 */
    .pagination-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
      padding: 15px;
    }

    .pagination-btn {
      padding: 8px 16px;
      border: 1px solid #ddd;
      background: white;
      color: #666;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .pagination-btn:hover:not(:disabled) {
      background: #409EFF;
      color: white;
      border-color: #409EFF;
    }

    .pagination-btn:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .pagination-info {
      margin: 0 15px;
      font-weight: 500;
      color: #303133;
    }

    /* 搜索按钮样式 */
    .admin-btn-text {
      background: #f5f7fa;
      color: #606266;
      border: 1px solid #dcdfe6;
    }

    .admin-btn-text:hover {
      background: #ecf5ff;
      color: #409EFF;
      border-color: #c6e2ff;
    }

    /* 操作按钮组 */
    .post-actions {
      display: flex;
      gap: 5px;
    }

    .post-action-btn {
      padding: 4px 8px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 12px;
    }

    .post-action-btn.edit {
      background: #e1f3d8;
      color: #67c23a;
    }

    .post-action-btn.preview {
      background: #e6f7ff;
      color: #1890ff;
    }

    /* 排序样式 */
    .sortable {
      cursor: pointer;
      user-select: none;
      position: relative;
    }

    .sortable:hover {
      background-color: #eef1f6;
    }

    .sortable i {
      margin-left: 5px;
      opacity: 0.5;
    }

    .sortable.asc i::before {
      content: "\f0de"; /* fa-sort-up */
      opacity: 1;
    }

    .sortable.desc i::before {
      content: "\f0dd"; /* fa-sort-down */
      opacity: 1;
    }

    .post-action-btn.delete {
      background: #fde2e2;
      color: #f56c6c;
    }

    .post-action-btn:hover {
      transform: scale(1.1);
    }

    .pagination-container {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .pagination-btn {
      padding: 8px 16px;
      border: 1px solid #dcdfe6;
      background: white;
      color: #606266;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .pagination-btn:hover {
      background: #409EFF;
      color: white;
      border-color: #409EFF;
    }

    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pagination-info {
      padding: 0 15px;
      color: #606266;
    }

    .loading-row {
      text-align: center;
      padding: 40px 20px;
      color: #909399;
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #409EFF;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .search-box {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .posts-table {
        font-size: 14px;
      }

      .posts-table th,
      .posts-table td {
        padding: 8px 10px;
      }
    }
  </style>

  <script>
    let posts = [];
    let filteredPosts = [];
    let currentPage = 1;
    let totalPages = 1;
    let totalPosts = 0;
    const pageSize = 10; // 每页显示10篇文章
    let sortBy = 'date';
    let sortOrder = 'desc';
    let searchTerm = '';
    let selectedCategory = '';
    let selectedStatus = '';

    // 初始化页面
    document.addEventListener('DOMContentLoaded', function() {
      loadPosts();
      loadCategories();
      
      // 初始化搜索功能
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          searchTerm = this.value;
          applyFilters();
          displayCurrentPage();
          updatePagination();
          updateStats();
        });
      }
      
      // 初始化分类过滤
      const categoryFilter = document.getElementById('categoryFilter');
      if (categoryFilter) {
        categoryFilter.addEventListener('change', function() {
          selectedCategory = this.value;
          applyFilters();
          displayCurrentPage();
          updatePagination();
          updateStats();
        });
      }
      
      // 初始化状态过滤
      const statusFilter = document.getElementById('statusFilter');
      if (statusFilter) {
        statusFilter.addEventListener('change', function() {
          selectedStatus = this.value;
          applyFilters();
          displayCurrentPage();
          updatePagination();
          updateStats();
        });
      }
    });

    // 加载分类列表
    async function loadCategories() {
      try {
        const response = await fetch('/admin-api/posts?page=1&pageSize=999&metadataOnly=true');
        const data = await response.json();
        
        let posts = [];
        if (data.success && data.data) {
          posts = data.data;
        } else if (Array.isArray(data)) {
          posts = data;
        }
        
        // 收集所有分类
        const categories = new Set();
        posts.forEach(post => {
          if (post.frontMatter?.categories) {
            if (Array.isArray(post.frontMatter.categories)) {
              post.frontMatter.categories.forEach(cat => categories.add(cat));
            } else {
              categories.add(post.frontMatter.categories);
            }
          }
          if (post.frontMatter?.category) {
            categories.add(post.frontMatter.category);
          }
        });
        
        // 更新分类下拉选项
        const categorySelect = document.getElementById('categoryFilter');
        if (categorySelect) {
          categorySelect.innerHTML = '<option value="">所有分类</option>';
          Array.from(categories).sort().forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categorySelect.appendChild(option);
          });
        }
      } catch (error) {
        console.error('加载分类失败:', error);
      }
    }

    // 加载文章列表
    async function loadPosts() {
      try {
        showLoading();
        
        const response = await fetch('/admin-api/posts?page=1&pageSize=999&metadataOnly=false');
        const data = await response.json();
        
        if (data.success && data.data) {
          posts = data.data;
        } else if (Array.isArray(data)) {
          posts = data;
        } else {
          throw new Error(data.error || '数据格式错误');
        }
        
        // 应用过滤和搜索
        applyFilters();
        
        // 初始化分页显示
        displayCurrentPage();
        updatePagination();
        updateStats();
        
      } catch (error) {
        console.error('加载文章失败:', error);
        showError('加载文章失败: ' + (error.message || '未知错误'));
      }
    }

    // 应用过滤器
    function applyFilters() {
      filteredPosts = posts.filter(post => {
        // 搜索过滤
        if (searchTerm) {
          const title = post.title?.toLowerCase() || '';
          const content = post.content?.toLowerCase() || '';
          const searchLower = searchTerm.toLowerCase();
          if (!title.includes(searchLower) && !content.includes(searchLower)) {
            return false;
          }
        }
        
        // 分类过滤
        if (selectedCategory) {
          const categories = post.frontMatter?.categories || post.frontMatter?.category || [];
          const categoryArray = Array.isArray(categories) ? categories : [categories];
          if (!categoryArray.includes(selectedCategory)) {
            return false;
          }
        }
        
        // 状态过滤
        if (selectedStatus) {
          const isDraft = post.source?.includes('_drafts') || post.draft;
          if (selectedStatus === 'published' && isDraft) return false;
          if (selectedStatus === 'draft' && !isDraft) return false;
        }
        
        return true;
      });
      
      // 排序
      filteredPosts.sort((a, b) => {
        const dateA = new Date(a.frontMatter?.date || a.date || '1970-01-01');
        const dateB = new Date(b.frontMatter?.date || b.date || '1970-01-01');
        return sortOrder === 'asc' ? dateA - dateB : dateB - dateA;
      });
      
      // 更新分页信息
      totalPosts = filteredPosts.length;
      totalPages = Math.ceil(totalPosts / pageSize);
      currentPage = Math.min(currentPage, Math.max(1, totalPages));
    }

    // 显示当前页数据
    function displayCurrentPage() {
      const startIndex = (currentPage - 1) * pageSize;
      const endIndex = startIndex + pageSize;
      const currentPosts = filteredPosts.slice(startIndex, endIndex);
      
      updatePostsTable(currentPosts);
    }

    // 更新文章表格
    function updatePostsTable(postsToShow) {
      const tbody = document.getElementById('postsTableBody');
      
      if (!postsToShow || postsToShow.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" class="loading-row">
              暂无文章数据
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = postsToShow.map(post => {
        // 从不同位置获取数据
        const frontMatter = post.frontMatter || {};
        const date = frontMatter.date || post.date ? new Date(frontMatter.date || post.date).toLocaleDateString('zh-CN') : '未知';
        
        // 处理分类数据
        let category = '未分类';
        if (frontMatter.categories && Array.isArray(frontMatter.categories)) {
          category = frontMatter.categories[0];
        } else if (frontMatter.categories) {
          category = frontMatter.categories;
        } else if (post.category) {
          category = post.category;
        }
        
        // 处理标签数据
        let tags = '';
        if (frontMatter.tags && Array.isArray(frontMatter.tags)) {
          tags = frontMatter.tags.join(', ');
        } else if (frontMatter.tags) {
          tags = frontMatter.tags;
        } else if (post.tags) {
          tags = Array.isArray(post.tags) ? post.tags.join(', ') : post.tags;
        }
        
        // 判断草稿状态
        const isDraft = frontMatter.draft === true || post.draft === true || post.published === false || post.layout === 'draft';
        const status = isDraft ? 'draft' : 'published';
        const statusText = isDraft ? '草稿' : '已发布';
        
        return `
          <tr>
            <td>
              <div class="post-title" onclick="previewPost('${post.slug || post.path || post.title}')">${post.title || '无标题'}</div>
            </td>
            <td>${date}</td>
            <td>${category}</td>
            <td>${tags}</td>
            <td>
              <span class="post-status ${status}">${statusText}</span>
            </td>
            <td>
              <div class="post-actions">
                <button class="post-action-btn preview" onclick="previewPost('${post.slug || post.path || post.title}')" title="预览">
                  <i class="fas fa-eye"></i> 预览
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // 更新分页
    function updatePagination() {
      const currentPageElement = document.getElementById('currentPageNum');
      if (currentPageElement) {
        currentPageElement.textContent = currentPage;
      }
      
      // 更新分页信息显示
      const paginationInfo = document.querySelector('.pagination-info');
      if (paginationInfo) {
        paginationInfo.innerHTML = `第 <span id="currentPageNum">${currentPage}</span> 页，共 ${totalPages} 页`;
      }
      
      const pagination = document.getElementById('paginationContainer');
      if (pagination) {
        pagination.style.display = totalPages > 1 ? 'flex' : 'none';
        
        const buttons = pagination.querySelectorAll('.pagination-btn');
        
        if (buttons.length >= 5) {
          buttons[0].disabled = currentPage <= 1; // 首页
          buttons[1].disabled = currentPage <= 1; // 上一页
          buttons[3].disabled = currentPage >= totalPages; // 下一页
          buttons[4].disabled = currentPage >= totalPages; // 末页
        }
      }
    }

    // 更新分类选项
    async function updateCategories() {
      const categorySet = new Set();
      
      // 从当前文章数据获取分类
      posts.forEach(post => {
        const frontMatter = post.frontMatter || {};
        
        // 从frontMatter获取分类
        if (frontMatter.categories && Array.isArray(frontMatter.categories)) {
          frontMatter.categories.forEach(cat => categorySet.add(cat));
        } else if (frontMatter.categories) {
          categorySet.add(frontMatter.categories);
        }
        
        // 备用：从post直接获取
        if (post.category) categorySet.add(post.category);
        if (post.categories) {
          if (Array.isArray(post.categories)) {
            post.categories.forEach(cat => categorySet.add(cat));
          } else {
            categorySet.add(post.categories);
          }
        }
      });
      
      // 尝试从Notion API获取更多分类选项
      try {
        const notionCategories = await fetchNotionCategories();
        notionCategories.forEach(cat => categorySet.add(cat));
      } catch (error) {
        console.log('无法从Notion获取分类:', error);
      }
      
      const categoryFilter = document.getElementById('categoryFilter');
      categoryFilter.innerHTML = '<option value="">所有分类</option>';
      Array.from(categorySet).sort().forEach(category => {
        categoryFilter.innerHTML += `<option value="${category}">${category}</option>`;
      });
    }

    // 从Notion API获取分类选项
    async function fetchNotionCategories() {
      try {
        // 这里应该调用你的后端API来获取Notion数据
        // 暂时返回一些常见分类，你可以根据实际情况调整
        const commonCategories = [
          '产品经理',
          '技术开发', 
          '项目管理',
          '数据分析',
          '用户体验',
          '市场营销',
          '商业模式',
          '行业洞察',
          '团队管理',
          '个人成长'
        ];
        
        return commonCategories;
      } catch (error) {
        console.error('获取Notion分类失败:', error);
        return [];
      }
    }

    // 更新统计信息
    function updateStats() {
      document.getElementById('totalPosts').textContent = totalPosts;
      document.getElementById('currentPage').textContent = currentPage;
    }

    // 搜索文章 - 支持全量数据搜索
    async function searchPosts() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const categoryFilter = document.getElementById('categoryFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;
      
      try {
        // 获取所有文章数据进行前端筛选
        const response = await fetch('/admin-api/posts?page=1&pageSize=999');
        const data = await response.json();
        
        if (data.success !== false) {
          let allPosts = data.data || data.posts || [];
          
          // 前端筛选
          let filteredPosts = allPosts.filter(post => {
            const frontMatter = post.frontMatter || {};
            
            // 标题搜索
            const titleMatch = !searchTerm || (post.title && post.title.toLowerCase().includes(searchTerm));
            
            // 分类筛选
            let categoryMatch = true;
            if (categoryFilter) {
              if (frontMatter.categories && Array.isArray(frontMatter.categories)) {
                categoryMatch = frontMatter.categories.includes(categoryFilter);
              } else if (frontMatter.categories) {
                categoryMatch = frontMatter.categories === categoryFilter;
              } else if (post.category) {
                categoryMatch = post.category === categoryFilter;
              } else {
                categoryMatch = false;
              }
            }
            
            // 状态筛选
            let statusMatch = true;
            if (statusFilter) {
              const isDraft = frontMatter.draft === true || post.draft === true || post.published === false || post.layout === 'draft';
              if (statusFilter === 'draft') {
                statusMatch = isDraft;
              } else if (statusFilter === 'published') {
                statusMatch = !isDraft;
              }
            }
            
            return titleMatch && categoryMatch && statusMatch;
          });
          
          posts = filteredPosts;
          totalPosts = filteredPosts.length;
          totalPages = Math.ceil(totalPosts / 8);
          currentPage = 1;
          
          updatePostsTable(posts.slice(0, 8));
          updatePagination();
          updateStats();
        } else {
          showError('搜索失败: ' + (data.error || data.message || '未知错误'));
        }
      } catch (error) {
        console.error('搜索出错:', error);
        showError('搜索出错，请重试');
      }
    }

    // 清除搜索
    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.getElementById('categoryFilter').value = '';
      document.getElementById('statusFilter').value = '';
      loadPosts(); // 重新加载所有数据
    }

    // 翻页
    function goToPage(page) {
      if (page < 1 || page > totalPages) return;
      
      currentPage = page;
      displayCurrentPage();
      updatePagination();
      updateStats();
    }

    // 文章操作函数
    function createNewPost() {
      const confirmed = confirm('要创建新文章吗？\n\n请在Notion中创建文章，然后在博客后台同步。\n\n点击"确定"跳转到Notion编辑页面。');
      
      if (confirmed) {
        window.open('https://www.notion.so/daboss01/1c1ed4b7aaea81ed9e46fd7f0ee61cd5?v=20ded4b7aaea80069278000c7f67593c', '_blank');
      }
    }

    function editPost(slug) {
      window.location.href = `/admin/direct-manager.html#edit/${encodeURIComponent(slug)}`;
    }

    function previewPost(slug) {
      // 从slug中提取文件名和日期信息
      let postPath = slug;
      
      // 移除.md扩展名
      if (postPath.endsWith('.md')) {
        postPath = postPath.replace(/\.md$/, '');
      }
      
      // 如果是完整路径，提取文件名
      if (postPath.includes('/')) {
        postPath = postPath.split('/').pop();
      }
      
      // 解码URL编码的中文字符
      try {
        postPath = decodeURIComponent(postPath);
      } catch (e) {
        // 如果解码失败，保持原样
      }
      
      // 根据Hexo的permalink配置生成URL
      // permalink: ":year/:month/:day/:title/"
      const urls = [];
      
      // 尝试解析文件名中的日期和标题信息，支持带6位哈希的格式
      const dateMatch = postPath.match(/^(\d{4})-(\d{2})-(\d{2})-(.+?)(?:-[a-f0-9]{6})?$/);
      if (dateMatch) {
        const [, year, month, day, title] = dateMatch;
        // 根据Hexo permalink配置构建URL，包含完整的原始文件名
        urls.push(`/${year}/${month}/${day}/${postPath}/`);
        urls.push(`/${year}/${month}/${day}/${postPath}/index.html`);
        
        // 也尝试不带哈希的标题
        urls.push(`/${year}/${month}/${day}/${title}/`);
        urls.push(`/${year}/${month}/${day}/${title}/index.html`);
      }
      
      // 备用URL格式
      urls.push(`/${postPath}/`);
      urls.push(`/${postPath}/index.html`);
      
      console.log('尝试预览文章，候选URLs:', urls);
      
      // 逐个测试URL，找到第一个可用的
      async function testUrls(urlList, index = 0) {
        if (index >= urlList.length) {
          if (confirm('文章预览链接无法找到！\n\n是否打开博客首页手动查找？')) {
            window.open('/', '_blank');
          }
          return;
        }
        
        const currentUrl = urlList[index];
        
        try {
          const response = await fetch(currentUrl, { 
            method: 'HEAD',
            signal: AbortSignal.timeout(2000)
          });
          
          if (response.ok) {
            window.open(currentUrl, '_blank');
            return;
          } else {
            testUrls(urlList, index + 1);
          }
        } catch (error) {
          testUrls(urlList, index + 1);
        }
      }
      
      testUrls(urls);
    }

    function deletePost(slug) {
      if (confirm('确定要删除这篇文章吗？此操作不可撤销。')) {
        alert('删除功能开发中...');
      }
    }

    function syncPosts() {
      if (confirm('确定要从Notion导入文章吗？')) {
        alert('导入功能开发中...');
      }
    }

    function syncPostsAuto() {
      if (confirm('确定要同步所有文章吗？')) {
        alert('同步功能开发中...');
      }
    }

    function importFromYuque() {
      window.location.href = '/admin/yuque-import.html';
    }

    function sortPosts(field) {
      if (sortBy === field) {
        sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
      } else {
        sortBy = field;
        sortOrder = 'desc';
      }
      
      applyFilters();
      displayCurrentPage();
      updatePagination();
    }

    function showLoading() {
      const tbody = document.getElementById('postsTableBody');
      tbody.innerHTML = `
        <tr>
          <td colspan="6" class="loading-row">
            <i class="fas fa-spinner fa-spin"></i> 正在加载...
          </td>
        </tr>
      `;
    }

    function showError(message) {
      const tbody = document.getElementById('postsTableBody');
      tbody.innerHTML = `
        <tr>
          <td colspan="6" class="loading-row" style="color: #f56c6c;">
            <i class="fas fa-exclamation-triangle"></i> ${message}
          </td>
        </tr>
      `;
    }

    function logout() {
      localStorage.removeItem('adminLoggedIn');
      window.location.href = '/admin/login.html';
    }
  </script>
</body>
</html>